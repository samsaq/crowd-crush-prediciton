<?xml version="1.0" encoding="utf-8"?>
<Experiment>
  <Description>Train Platform - Bidirectional flow between platform and train doors</Description>
  
  <World>
    <Objects>
      <!-- Platform boundaries -->
      <Object name="platform_boundary" type="Rectangle" x="0" y="-12" width="100" height="1" />
      <Object name="train_wall" type="Rectangle" x="0" y="2" width="100" height="1" />
      
      <!-- Platform barriers -->
      <Object name="barrier1" type="Rectangle" x="-40" y="-6" width="1" height="6" />
      <Object name="barrier2" type="Rectangle" x="-20" y="-6" width="1" height="6" />
      <Object name="barrier3" type="Rectangle" x="0" y="-6" width="1" height="6" />
      <Object name="barrier4" type="Rectangle" x="20" y="-6" width="1" height="6" />
      <Object name="barrier5" type="Rectangle" x="40" y="-6" width="1" height="6" />
      
      <!-- Train doors (gaps in the train wall) -->
      <!-- The train wall is broken into segments with gaps for doors -->
      <Object name="train_wall1" type="Rectangle" x="-45" y="2" width="10" height="1" />
      <Object name="train_wall2" type="Rectangle" x="-30" y="2" width="10" height="1" />
      <Object name="train_wall3" type="Rectangle" x="-15" y="2" width="10" height="1" />
      <Object name="train_wall4" type="Rectangle" x="0" y="2" width="10" height="1" />
      <Object name="train_wall5" type="Rectangle" x="15" y="2" width="10" height="1" />
      <Object name="train_wall6" type="Rectangle" x="30" y="2" width="10" height="1" />
      <Object name="train_wall7" type="Rectangle" x="45" y="2" width="10" height="1" />
    </Objects>
  </World>
  
  <PolicyMakers>
    <!-- Policies for passengers disembarking from train -->
    <PolicyMaker name="PM-disembark-exit1" type="DesiredVelocityPolicy">
      <Parameters>
        <Parameter name="desired_speed" value="1.3" />
        <Parameter name="goal_point" value="-40,-20" />
      </Parameters>
    </PolicyMaker>
    
    <PolicyMaker name="PM-disembark-exit2" type="DesiredVelocityPolicy">
      <Parameters>
        <Parameter name="desired_speed" value="1.3" />
        <Parameter name="goal_point" value="0,-20" />
      </Parameters>
    </PolicyMaker>
    
    <PolicyMaker name="PM-disembark-exit3" type="DesiredVelocityPolicy">
      <Parameters>
        <Parameter name="desired_speed" value="1.3" />
        <Parameter name="goal_point" value="40,-20" />
      </Parameters>
    </PolicyMaker>
    
    <!-- Policies for passengers waiting to board the train -->
    <PolicyMaker name="PM-board-door1" type="DesiredVelocityPolicy">
      <Parameters>
        <Parameter name="desired_speed" value="1.2" />
        <Parameter name="goal_point" value="-37.5,5" />
      </Parameters>
    </PolicyMaker>
    
    <PolicyMaker name="PM-board-door2" type="DesiredVelocityPolicy">
      <Parameters>
        <Parameter name="desired_speed" value="1.2" />
        <Parameter name="goal_point" value="-22.5,5" />
      </Parameters>
    </PolicyMaker>
    
    <PolicyMaker name="PM-board-door3" type="DesiredVelocityPolicy">
      <Parameters>
        <Parameter name="desired_speed" value="1.2" />
        <Parameter name="goal_point" value="-7.5,5" />
      </Parameters>
    </PolicyMaker>
    
    <PolicyMaker name="PM-board-door4" type="DesiredVelocityPolicy">
      <Parameters>
        <Parameter name="desired_speed" value="1.2" />
        <Parameter name="goal_point" value="7.5,5" />
      </Parameters>
    </PolicyMaker>
    
    <PolicyMaker name="PM-board-door5" type="DesiredVelocityPolicy">
      <Parameters>
        <Parameter name="desired_speed" value="1.2" />
        <Parameter name="goal_point" value="22.5,5" />
      </Parameters>
    </PolicyMaker>
    
    <PolicyMaker name="PM-board-door6" type="DesiredVelocityPolicy">
      <Parameters>
        <Parameter name="desired_speed" value="1.2" />
        <Parameter name="goal_point" value="37.5,5" />
      </Parameters>
    </PolicyMaker>
  </PolicyMakers>
  
  <Agents>
    <!-- Disembarking passengers inside the train -->
    <Generator type="RandomGenerator">
      <Parameters>
        <Parameter name="policy_maker_distribution" value="PM-disembark-exit1=0.33;PM-disembark-exit2=0.34;PM-disembark-exit3=0.33" />
        <Parameter name="agent_radius" value="0.25" />
        <Parameter name="agent_mass" value="75" />
        <Parameter name="count" value="180" />
        <Parameter name="position_region" value="Rectangle,-50,5,100,10" />
      </Parameters>
    </Generator>
    
    <!-- Passengers waiting to board at each door -->
    <!-- Door 1 waiting area -->
    <Generator type="GridGenerator">
      <Parameters>
        <Parameter name="policy_maker" value="PM-board-door1" />
        <Parameter name="agent_radius" value="0.25" />
        <Parameter name="agent_mass" value="75" />
        <Parameter name="row_count" value="5" />
        <Parameter name="col_count" value="6" />
        <Parameter name="row_gap" value="0.7" />
        <Parameter name="col_gap" value="0.7" />
        <Parameter name="pos_x" value="-37.5" />
        <Parameter name="pos_y" value="-8" />
        <Parameter name="noise" value="0.2" />
      </Parameters>
    </Generator>
    
    <!-- Door 2 waiting area -->
    <Generator type="GridGenerator">
      <Parameters>
        <Parameter name="policy_maker" value="PM-board-door2" />
        <Parameter name="agent_radius" value="0.25" />
        <Parameter name="agent_mass" value="75" />
        <Parameter name="row_count" value="5" />
        <Parameter name="col_count" value="6" />
        <Parameter name="row_gap" value="0.7" />
        <Parameter name="col_gap" value="0.7" />
        <Parameter name="pos_x" value="-22.5" />
        <Parameter name="pos_y" value="-8" />
        <Parameter name="noise" value="0.2" />
      </Parameters>
    </Generator>
    
    <!-- Door 3 waiting area -->
    <Generator type="GridGenerator">
      <Parameters>
        <Parameter name="policy_maker" value="PM-board-door3" />
        <Parameter name="agent_radius" value="0.25" />
        <Parameter name="agent_mass" value="75" />
        <Parameter name="row_count" value="5" />
        <Parameter name="col_count" value="6" />
        <Parameter name="row_gap" value="0.7" />
        <Parameter name="col_gap" value="0.7" />
        <Parameter name="pos_x" value="-7.5" />
        <Parameter name="pos_y" value="-8" />
        <Parameter name="noise" value="0.2" />
      </Parameters>
    </Generator>
    
    <!-- Door 4 waiting area -->
    <Generator type="GridGenerator">
      <Parameters>
        <Parameter name="policy_maker" value="PM-board-door4" />
        <Parameter name="agent_radius" value="0.25" />
        <Parameter name="agent_mass" value="75" />
        <Parameter name="row_count" value="5" />
        <Parameter name="col_count" value="6" />
        <Parameter name="row_gap" value="0.7" />
        <Parameter name="col_gap" value="0.7" />
        <Parameter name="pos_x" value="7.5" />
        <Parameter name="pos_y" value="-8" />
        <Parameter name="noise" value="0.2" />
      </Parameters>
    </Generator>
    
    <!-- Door 5 waiting area -->
    <Generator type="GridGenerator">
      <Parameters>
        <Parameter name="policy_maker" value="PM-board-door5" />
        <Parameter name="agent_radius" value="0.25" />
        <Parameter name="agent_mass" value="75" />
        <Parameter name="row_count" value="5" />
        <Parameter name="col_count" value="6" />
        <Parameter name="row_gap" value="0.7" />
        <Parameter name="col_gap" value="0.7" />
        <Parameter name="pos_x" value="22.5" />
        <Parameter name="pos_y" value="-8" />
        <Parameter name="noise" value="0.2" />
      </Parameters>
    </Generator>
    
    <!-- Door 6 waiting area -->
    <Generator type="GridGenerator">
      <Parameters>
        <Parameter name="policy_maker" value="PM-board-door6" />
        <Parameter name="agent_radius" value="0.25" />
        <Parameter name="agent_mass" value="75" />
        <Parameter name="row_count" value="5" />
        <Parameter name="col_count" value="6" />
        <Parameter name="row_gap" value="0.7" />
        <Parameter name="col_gap" value="0.7" />
        <Parameter name="pos_x" value="37.5" />
        <Parameter name="pos_y" value="-8" />
        <Parameter name="noise" value="0.2" />
      </Parameters>
    </Generator>
  </Agents>
  
  <AgentInteraction>
    <Algorithm type="ORCA">
      <Parameters>
        <Parameter name="tau" value="0.8" />
        <Parameter name="neighbor_dist" value="5.0" />
        <Parameter name="time_horizon" value="2.0" />
        <Parameter name="time_horizon_obst" value="1.0" />
      </Parameters>
    </Algorithm>
  </AgentInteraction>
  
  <Duration value="120.0" /> <!-- 2 minutes of simulation -->
  <TimeStep value="0.05" />
  <OutputData folder="output_data" />
</Experiment> 