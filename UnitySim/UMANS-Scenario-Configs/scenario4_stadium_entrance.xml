<?xml version="1.0" encoding="utf-8"?>
<Experiment>
  <Description>Stadium Entrance - Funnel-shaped entrance causing bottleneck</Description>
  
  <World>
    <Objects>
      <!-- Funnel entrance structure -->
      <Object name="funnel_top_left" type="Rectangle" x="-40" y="20" width="30" height="1" />
      <Object name="funnel_top_right" type="Rectangle" x="10" y="20" width="30" height="1" />
      <Object name="funnel_bottom_left" type="Rectangle" x="-40" y="-20" width="30" height="1" />
      <Object name="funnel_bottom_right" type="Rectangle" x="10" y="-20" width="30" height="1" />
      
      <!-- Funnel converging walls -->
      <Object name="funnel_left_top" type="Rectangle" x="-10" y="15" width="1" height="10" />
      <Object name="funnel_left_bottom" type="Rectangle" x="-10" y="-15" width="1" height="10" />
      <Object name="funnel_right_top" type="Rectangle" x="10" y="15" width="1" height="10" />
      <Object name="funnel_right_bottom" type="Rectangle" x="10" y="-15" width="1" height="10" />
      
      <!-- Security check/ticket gate - narrow entrances -->
      <Object name="gate_top" type="Rectangle" x="0" y="5" width="20" height="1" />
      <Object name="gate_bottom" type="Rectangle" x="0" y="-5" width="20" height="1" />
      <Object name="gate_middle1" type="Rectangle" x="0" y="2" width="19" height="1" />
      <Object name="gate_middle2" type="Rectangle" x="0" y="-2" width="19" height="1" />
    </Objects>
  </World>
  
  <PolicyMakers>
    <PolicyMaker name="PM-approach" type="DesiredVelocityPolicy">
      <Parameters>
        <Parameter name="desired_speed" value="1.2" />
        <Parameter name="goal_point" value="-5,0" />
      </Parameters>
    </PolicyMaker>
    
    <PolicyMaker name="PM-enter-top" type="DesiredVelocityPolicy">
      <Parameters>
        <Parameter name="desired_speed" value="1.0" />
        <Parameter name="goal_point" value="5,3.5" />
      </Parameters>
    </PolicyMaker>
    
    <PolicyMaker name="PM-enter-bottom" type="DesiredVelocityPolicy">
      <Parameters>
        <Parameter name="desired_speed" value="1.0" />
        <Parameter name="goal_point" value="5,-3.5" />
      </Parameters>
    </PolicyMaker>
    
    <PolicyMaker name="PM-exit" type="DesiredVelocityPolicy">
      <Parameters>
        <Parameter name="desired_speed" value="1.2" />
        <Parameter name="goal_point" value="40,0" />
      </Parameters>
    </PolicyMaker>
  </PolicyMakers>
  
  <Agents>
    <!-- Approaching crowd outside stadium -->
    <Generator type="GridGenerator">
      <Parameters>
        <Parameter name="policy_maker" value="PM-approach" />
        <Parameter name="agent_radius" value="0.25" />
        <Parameter name="agent_mass" value="75" />
        <Parameter name="row_count" value="15" />
        <Parameter name="col_count" value="10" />
        <Parameter name="row_gap" value="1.0" />
        <Parameter name="col_gap" value="1.0" />
        <Parameter name="pos_x" value="-30" />
        <Parameter name="pos_y" value="0" />
        <Parameter name="noise" value="0.3" />
      </Parameters>
    </Generator>
    
    <!-- Controllers/security at checkpoints -->
    <Agent>
      <Parameters>
        <Parameter name="radius" value="0.3" />
        <Parameter name="mass" value="80" />
        <Parameter name="policy_id" value="0" />
      </Parameters>
      <Position x="0" y="3.5" />
      <PolicyMakerID value="PM-exit" />
    </Agent>
    <Agent>
      <Parameters>
        <Parameter name="radius" value="0.3" />
        <Parameter name="mass" value="80" />
        <Parameter name="policy_id" value="0" />
      </Parameters>
      <Position x="0" y="-3.5" />
      <PolicyMakerID value="PM-exit" />
    </Agent>
  </Agents>
  
  <AgentInteraction>
    <Algorithm type="ORCA">
      <Parameters>
        <Parameter name="tau" value="1.0" />
        <Parameter name="neighbor_dist" value="5.0" />
      </Parameters>
    </Algorithm>
  </AgentInteraction>
  
  <Duration value="240.0" /> <!-- 4 minutes of simulation -->
  <TimeStep value="0.05" />
  <OutputData folder="output_data" />
</Experiment> 